var e,s,t,n,a;function i(e,s,t,n){return{getAddress:()=>e,getPrivateKey:()=>{throw new Error("getPrivateKey is not available")},signHash:async a=>{const{result:i}=await s.sendRequest(t,{scope:"signer",command:"signHash",arguments:JSON.stringify({signerAddress:e,hash:a})},n);return i},signMessage:async a=>{const{result:i}=await s.sendRequest(t,{scope:"signer",command:"signMessage",arguments:JSON.stringify({signerAddress:e,message:a})},n);return i},prepareTransaction:async a=>{const{result:i}=await s.sendRequest(t,{scope:"signer",command:"prepareTransaction",arguments:JSON.stringify({signerAddress:e,transaction:a})},n);return i},signTransaction:async(a,i)=>{const{result:r}=await s.sendRequest(t,{scope:"signer",command:"signTransaction",arguments:JSON.stringify({signerAddress:e,transaction:a,options:{abis:i}})},n);return r},sendTransaction:async(a,i)=>{const{result:r}=await s.sendRequest(t,{scope:"signer",command:"signAndSendTransaction",arguments:JSON.stringify({signerAddress:e,transaction:a,options:i})},n);return r},prepareBlock:()=>{throw new Error("prepareBlock is not available")},signBlock:()=>{throw new Error("signBlock is not available")}}}e=module.exports,Object.defineProperty(e,"__esModule",{value:!0,configurable:!0}),s=module.exports,t="default",n=()=>l,Object.defineProperty(s,t,{get:n,set:a,enumerable:!0,configurable:!0});const r="messenger::ping::request";class o{constructor(e,s,t=!0,n="*"){this.id=s,this.target=e,this.isTargetWindow=t,this.targetOrigin=n,this.onMessageListenerAdded=!1,this.addMessageListener()}onMessageListener=async e=>{if("*"!==this.targetOrigin&&!this.targetOrigin.startsWith(e.origin))return;const{data:s,ports:t}=e;s.type!==r&&s.to!==this.id||(s&&t&&t[0]?(s.type===r?t[0].postMessage({type:"messenger::ping::ack"}):this.onRequestFn&&await this.onRequestFn({sender:e.origin,data:JSON.parse(s.data),sendData:e=>{t[0].postMessage({data:e})},sendError:e=>{t[0].postMessage({error:e})}}),t[0].close()):s&&this.onMessageFn&&this.onMessageFn({sender:e.origin,data:JSON.parse(s.data)}))};addMessageListener=()=>{this.onMessageListenerAdded||(this.onMessageListenerAdded=!0,self.addEventListener("message",this.onMessageListener))};ping=async(e,s=20)=>{if(!this.onMessageListenerAdded)throw new Error("ping was cancelled");try{await this._sendRequest({type:r,from:this.id,to:e},500)}catch(t){if(--s<=0)throw new Error(`could not ping target "${e}"`);await this.ping(e,s)}};onMessage=e=>{this.onMessageFn=e};onRequest=e=>{this.onRequestFn=e};removeListener=()=>{this.onMessageListenerAdded&&(this.onMessageListenerAdded=!1,self.removeEventListener("message",this.onMessageListener))};sendMessage=(e,s)=>this._sendMessage({data:JSON.stringify(s),to:e,from:this.id});_sendMessage=e=>{this.isTargetWindow?this.target.postMessage(e,this.targetOrigin):this.target.postMessage(e)};sendRequest=(e,s,t=1e4)=>this._sendRequest({data:JSON.stringify(s),to:e,from:this.id},t);_sendRequest=(e,s=1e4)=>new Promise(((t,n)=>{let a;const{port1:i,port2:r}=new MessageChannel;i.onmessage=e=>{a&&self.clearTimeout(a),i.close();const s=e.data;s.error?n(s.error):t(s.data)},this.isTargetWindow?this.target.postMessage(e,this.targetOrigin,[r]):this.target.postMessage(e,[r]),s&&(a=self.setTimeout((()=>{n("request timed out")}),s))}))}let d=!1;const g="koinos-wallet-iframe",c="wallet-connector-child";new Promise(((e,s)=>{d?e():["loaded","interactive","complete"].indexOf(document.readyState)>-1?(d=!0,e()):window.addEventListener("load",(()=>{d=!0,e()}),!1)})).then((()=>{document.getElementsByClassName(g).length&&console.warn("Koinos-Wallet script was already loaded. This might cause unexpected behavior. If loading with a <script> tag, please make sure that you only load it once.")})).catch((()=>{}));class l{constructor(e){this.iframe=document.createElement("iframe"),this.iframe.id=g,this.iframe.hidden=!0,this.iframe.onload=()=>this.onIframeLoad(),this.iframe.src=e,document.body.appendChild(this.iframe),l.checkIfAlreadyInitialized()}close(){this.messenger.removeListener()}async onIframeLoad(){this.messenger=new o(this.iframe.contentWindow,"wallet-connector-parent"),await this.messenger.ping(c),console.log("connected to koinos-wallet-connector")}static checkIfAlreadyInitialized(){document.getElementsByClassName(g).length&&console.warn("An instance of Koinos-Wallet was already initialized. This is probably a mistake. Make sure that you use the same Koinos-Wallet instance throughout your app.")}async getAccounts(e=6e4){const{result:s}=await this.messenger.sendRequest(c,{scope:"accounts",command:"getAccounts"},e);return s}getSigner(e,s=6e4){return i(e,this.messenger,c,s)}}
//# sourceMappingURL=koinos-wallet.js.map
